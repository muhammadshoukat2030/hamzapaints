<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Products Bill | Hamza Paints</title>
  <link rel="icon" href="/images/weldon-paints-logo.png" type="image/png">
  <link rel="stylesheet" href="/stylesheets/printProducts.css">
</head>

<body>
  <div class="print-area">
    <div class="shop-header">
      <img src="/images/weldon-paints-logo.png" id="logo" />
      <div class="shop-name-en">Hamza Weldon Paint & Hardware Store</div>
      <div class="shop-name-ur">حمزہ ویلڈن پینٹ اینڈ ہارڈویئر سٹور</div>
      <div class="shop-phones">
        <span dir="ltr">0319-9303154</span>(حمزہ)
        <span dir="ltr">0332-9780911</span>(اسماعیل)
        <span dir="ltr">0335-0502041</span>(مبارک شاہ)
      </div>
      <div class="divider-line">------------------------------</div>
    </div>

    <p><b>Entry Date:</b> <span id="entryDate"><%= currentDate %></span></p>
    
    <h3>Product Details:</h3>
    <table>
      <thead>
        <tr>
          <th>Stock ID</th>
          <th>Brand Name</th>
          <th>Item</th>
          <th>Color</th>
          <th>Unit</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="printTableBody">
        </tbody>
    </table>

    <div class="footer">
      <span id="totalItemsCount">Total Items: 0</span>
      <span id="grandTotalAmount">Total Amount: Rs 0.00</span>
    </div>

    <div class="urdu-footer">
      پتہ: ملک تاج مارکیٹ، دکان نمبر 5،6
      کوہاٹ بورڈ ہائی وے چوک
    </div>

    <div class="thank-you-section">THANK YOU FOR VISITNG</div>
    <div class="dev-footer">
      <span>Software Developed by: M.SHOUKAT(0335 8004900)</span>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // 1. LocalStorage se data nikaalna
      const savedData = localStorage.getItem("lastAddedProducts");
      const tbody = document.getElementById("printTableBody");
      const totalItemsSpan = document.getElementById("totalItemsCount");
      const grandTotalSpan = document.getElementById("grandTotalAmount");

      if (savedData) {
        const products = JSON.parse(savedData);
        let tableHTML = "";
        let totalAmount = 0;

        // 2. Data ko table rows mein convert karna
        products.forEach(p => {
          const total = parseFloat((p.totalProduct * p.rate).toFixed(2));
          totalAmount += total;

          tableHTML += `
            <tr>
              <td>${p.stockID}</td>
              <td>${p.brandName}</td>
              <td>${p.itemName}</td>
              <td>${p.colourName}</td>
              <td>${p.qty}</td>
              <td>${p.totalProduct}</td>
              <td>Rs ${parseFloat(p.rate).toFixed(2)}</td>
              <td>Rs ${total.toFixed(2)}</td>
            </tr>`;
        });

        // 3. UI Update karna
        tbody.innerHTML = tableHTML;
        totalItemsSpan.innerText = `Total Items: ${products.length}`;
        grandTotalSpan.innerText = `Total Amount: Rs ${totalAmount.toFixed(2)}`;

    

      } else {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;">No data found to print</td></tr>`;
      }
    });
  </script>
</body>
</html>